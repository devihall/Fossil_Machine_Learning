
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Classification</title>
</head>
<body>
  <canvas id="canvas" width="128" height="128"></canvas>
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
  <script>
    // Define constants for image dimensions
    const IMAGE_WIDTH = 64;
    const IMAGE_HEIGHT = 64;
    const IMAGE_CHANNELS = 4;

    // Function to load an image asynchronously
    async function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    // Function to draw an image on a canvas
    function drawImageOnCanvas(image, canvas) {
      const ctx = canvas.getContext('2d');
      ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    }

    // Function to preprocess an image
    function preprocessImage(image) {
      const canvas = document.createElement('canvas');
      canvas.width = IMAGE_WIDTH;
      canvas.height = IMAGE_HEIGHT;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(image, 0, 0, IMAGE_WIDTH, IMAGE_HEIGHT);
      return ctx.getImageData(0, 0, IMAGE_WIDTH, IMAGE_HEIGHT);
    }

    // Function to set up the neural network and classify the test image
    async function setup() {
      // Load images
      const images = [];
      for (let i = 1; i <= 3; i++) {
        const a = await loadImage(`letterImages/A_0${i}.png`);
        const b = await loadImage(`letterImages/B_0${i}.png`);
        images.push({ image: a, label: 'A' });
        images.push({ image: b, label: 'B' });
      }

      // Load the test image
      const testA = await loadImage(`letterImages/A_01.png`);

      // Draw test image on canvas
      const canvas = document.getElementById('canvas');
      drawImageOnCanvas(testA, canvas);

      // Construct the neural network
      const nn = ml5.neuralNetwork({
        inputs: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],
        task: 'imageClassification',
        debug: true,
      });

      // Add data
      images.forEach(({ image, label }) => {
        const imageData = preprocessImage(image);
        nn.addData(imageData, { label });
      });

      // Normalize data
      nn.normalizeData();

      // Train the neural network
      nn.train({ epochs: 20 }, () => {
        console.log('Finished training');
        // Classify test image
        const testImageData = preprocessImage(testA);
        nn.classify(testImageData, (err, results) => {
          if (err) {
            console.error(err);
            return;
          }
          console.log(results);
          const percent = 100 * results[0].confidence;
          console.log(`${results[0].label} ${percent.toFixed(2)}%`);
        });
      });
    }

    // Call setup function when the page is loaded
    setup();
  </script>
</body>
</html>
