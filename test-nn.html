<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neural Network Classification</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.7.1/ml5.min.js"></script>
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>
</head>
<body>
  <h1>Neural Network Classification</h1>

  <button onclick="trainModel()">Train Model</button>
  <button onclick="classify()">Classify</button>

  <div class="neuralNetworkVis"></div>

  
  <script>
    // Step 1: load data or create some data
    const data = [
      { r: 255, g: 0, b: 0, color: "red-ish" },
      { r: 254, g: 0, b: 0, color: "red-ish" },
      { r: 253, g: 0, b: 0, color: "red-ish" },
      { r: 0, g: 255, b: 0, color: "green-ish" },
      { r: 0, g: 254, b: 0, color: "green-ish" },
      { r: 0, g: 253, b: 0, color: "green-ish" },
      { r: 0, g: 0, b: 255, color: "blue-ish" },
      { r: 0, g: 0, b: 254, color: "blue-ish" },
      { r: 0, g: 0, b: 253, color: "blue-ish" },
    ];

    // Step 2: set your neural network options
    const options = {
      task: "classification",
      debug: true,
    };

    // Step 3: initialize your neural network
    const nn = ml5.neuralNetwork(options);

    // Step 4: add data to the neural network
    data.forEach((item) => {
      const inputs = {
        r: item.r,
        g: item.g,
        b: item.b,
      };
      const output = {
        color: item.color,
      };

      nn.addData(inputs, output);
    });

    // Step 5: normalize your data;
    nn.normalizeData();

    // Step 6: train your neural network
    function trainModel() {
      const trainingOptions = {
        epochs: 32,
        batchSize: 12,
      };
    
     nn.train(trainingOptions,  whileTraining, finishedTraining)
    }

    // Step 7: use the trained model
    function finishedTraining() {
      console.log("Training finished");
      classify(); // Once training is finished, proceed with classification
    }

    // Step 7.1: Define a function to log loss while training and visualize with tf-vis
   // Step 7.1: Define a function to log loss while training and visualize with tf-vis
function whileTraining(epoch, loss) {

console.log(`Epoch ${epoch}, Loss: ${loss.loss}`);


//   console.log("Epoch", epoch);
// console.log("Loss:" , loss)
//   console.log(`Epoch ${epoch}, Loss: ${loss}`);
//   tfvis.show.history(document.getElementById('loss-chart'), { values: { loss } }, ['loss']);
// NeuralNetworkVis.trainingVis

   const lossDataForVisualization = epoch.map(
        (epochValue, index) => ({
          x: epochValue,
          y: loss[index],
        })
      );

      console.log ("lossDataForVisualization", lossDataForVisualization);
      
//       const data = {
//         values: [lossDataForVisualization],
//         series: ["Loss vs Epoch"],
//       };

//       // get container for loss graph
//       const container = document.getElementById("demo");
//       const options = {
//         xLabel: "Epoch",
//         yLabel: "Loss",
//       };
//       // create loss graph
//       tfvis.render.linechart(container, data, options);

}


    // Step 8: make a classification
    function classify() {
      const input = {
        r: 255,
        g: 0,
        b: 0,
      };
      nn.classify(input, handleResults);
    }

    // Step 9: define a function to handle the results of your classification
    function handleResults(error, result) {
      if (error) {
        console.error(error);
        return;
      }
      console.log("results from classification", result); // {label: 'red', confidence: 0.8};
    }

    // Step 10: Initialize tf-vis and set the active tab to .neuralNetworkVis
    // const neuralNetworkVis = document.querySelector('.neuralNetworkVis');
    // tfvis.visor().setActiveTab(neuralNetworkVis);

    // Optional: Visualize model summary
    // const model = tf.sequential();
    // model.add(tf.layers.dense({units: 10, inputShape: [784], activation: 'relu'}));
    // model.add(tf.layers.dense({units: 10, activation: 'softmax'}));
    // tfvis.show.modelSummary(neuralNetworkVis, model);
  </script>
  <div id="loss-chart"></div>
</body>
</html>

